<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile â€“ ReWear</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        font-family: "Poppins", "Nunito", sans-serif;
        background: #fdf6ec
          url("https://www.transparenttextures.com/patterns/recycled-paper.png");
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="navbarContainer"></div>
    <main class="container py-4">
      <div id="profileContent" class="mx-auto" style="max-width: 700px"></div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="firebase.js"></script>
    <script src="js/user.js"></script>
    <script>
      // Render navbar
      UserUtils.renderNavbar();
      // Load profile info
      firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
          window.location.href = "login.html";
          return;
        }
        const userDoc = await firebase
          .firestore()
          .collection("users")
          .doc(user.uid)
          .get();
        if (!userDoc.exists) return;
        const userData = userDoc.data();
        let html = `<div class='card p-4 mb-4 shadow-sm'>
        <h3 class='fw-bold mb-3'><i class='fas fa-user eco-icon'></i>Profile</h3>
        <div class='mb-2'><b>Name:</b> ${userData.name}</div>
        <div class='mb-2'><b>Phone:</b> ${userData.phone}</div>
        <div class='mb-2'><b>Location:</b> ${userData.location}</div>
        <div class='mb-2'><b>Role:</b> ${userData.role}</div>`;
        if (userData.role === "Donor") {
          // Query items
          const itemsSnap = await firebase
            .firestore()
            .collection("items")
            .where("donorId", "==", user.uid)
            .get();
          const items = itemsSnap.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
          html += `<div class='mb-2'><b>Total Clothes Donated:</b> ${items.length}</div>`;
          html += `<h5 class='mt-4 mb-3'>Your Donated Items</h5><div class='row'>`;
          for (const item of items) {
            html += `<div class='col-md-6 mb-4'><div class='card h-100 shadow-sm'>
            <img src='${
              item.imageUrl
            }' class='card-img-top' style='height:180px;object-fit:cover;border-radius:1rem 1rem 0 0;'>
            <div class='card-body'>
              <h6 class='fw-bold mb-1'>${item.title}</h6>
              <div class='mb-1'><span class='badge bg-success'>${
                item.category
              }</span> <span class='badge bg-info'>${
              item.condition
            }</span></div>
              <button class='btn btn-sm btn-outline-primary me-2' onclick='editItem("${
                item.id
              }")'><i class='fas fa-pen'></i> Edit</button>
              <button class='btn btn-sm btn-outline-danger' onclick='deleteItem("${
                item.id
              }", "${
              item.imagePath || ""
            }")'><i class='fas fa-trash'></i> Delete</button>
            </div></div></div>`;
          }
          html += `</div>`;
        } else {
          html += `<div class='alert alert-success mt-4'>Thank you for being part of ReWear and supporting sustainability!</div>`;
        }
        html += `</div>`;
        document.getElementById("profileContent").innerHTML = html;
      });
      // Edit/Delete handlers (to be implemented in js/donor.js)
      function editItem(itemId) {
        alert("Edit feature coming soon!");
      }
      function deleteItem(itemId, imagePath) {
        alert("Delete feature coming soon!");
      }
    </script>
  </body>
</html>
